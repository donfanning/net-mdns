TODO

- bug in each_resource inside each_resource... figure it out, or remove the timeout?

- raa

- upload

- TXT not returning multiple strings

- resolv.conf looks correct, but I can't resolv www.google.ca!

- Name#<< - append label(s) to a Name


Goals:

a)

  - fix Config/timeout/choice of candidates problems

  - test, do lookups, review code

  - remove timeout implementation?

  - produce patches against 1.8

b)

  - refactor into net/dns
  - implement network browwer
  - submit diffs
  - server
  - rinda?
  - client/server in test/unit


Projects:

  - use Message.decode to dump details of tcpdump logs

  - query weather reports, represent as iCalendars, with colors for wet/dry warm/cold!

  - install dns_sd.h API/new mDNSResolver

  - install DNSServiceDiscovery API


Open design issues

- net classes that do socketopts, so you don't have to pack the structs yourself! or maybe
  implement the 8 functions of Stevens?

- factor Resolv::DNS internals into module Net::DNS. As a module, I can do
  include Net::DNS, and use Name, etc.

 - DNS::Name should have to_str to advertise that it can be converted into a string?
   --> net.http can't be used with return values of SRV.target...

 - case equality?


      #  call-seq:
      #     name === obj    => true or false
      #  
      #  Case Equality---Returns <code>true</code> if <i>anObject</i> is an
      #  instance of +name+ or one of +name+'s descendents. Of
      #  limited use for modules, but can be used in <code>case</code>
      #  statements to classify objects by class.

   or maybe when '*.example.com'...

 - maybe I should allow the port to be configurable, so mDNS can run on other
   ports?

 - rename mdns.rb net/dns/multicast.rb?

 - namespace to put MDNS into?

 - get MDNS from Resolv's defaults

 - deal with timeout's

 - allow infinite loops, querying with no timeout


Open resolv.rb questions:

  - reverse DNS lookups done by sock.recv


questions:

  Shouldn't BasicSocket.do_not_reverse_lookup be set? Or be set on our sockets?
  It's weird that in @sock.recv we get a tuple with the address... when we ARE
  a resolver library.... and if you call resolv-replace, won't we call
  ourselves in order to resolve the IP when you call recv to get the peer info?
  And isn't resolv-replace ignoring BasicSocket.do_not_reverse_lookup?  So, it
  is very weird that resolv.rb does ad socket.recv that causes (blocking) DNS
  queries to occure for its peer IP address...

    Related: run ga using -r resolv-replace, see if ruby does the CNAME thing...


Things to take care of from the draft:

-  Any DNS query for a name ending with "254.169.in-addr.arpa." MUST
   be sent to the mDNS multicast address 224.0.0.251.

-  All Multicast DNS responses (including responses sent via unicast)
   MUST be sent with IP TTL set to 255.

-  A host sending Multicast DNS queries to a link-local destination address
   (including the 224.0.0.251 link-local multicast address) MUST verify that
   the IP TTL in response packets is 255, and silently discard any response
   packets where the IP TTL is not 255. See the IP_RECVTTL socket option.

-  Multicast DNS is a new protocol and doesn't (yet) have old buggy
   legacy implementations to constrain the design choices. Accordingly,
   it adopts the obvious simple solution: all names in Multicast DNS are
   encoded using UTF-8 [RFC 2279].

-  Multicast DNS Messages carried by UDP may be up to the IP MTU of the
   physical interface, less the space required for the IP header (20
   bytes for IPv4; 40 bytes for IPv6) and the UDP header (8 bytes).

   --> does Message truncate?

19.2. QR (Query/Response) Bit

   In query messages, MUST be zero.

19.3. OPCODE

   In both multicast query and multicast response messages, MUST be zero
   (only standard queries are currently supported over multicast, unless
   other queries are allowed by future IETF Standards Action).

19.4. AA (Authoritative Answer) Bit

   In query messages, the Authoritative Answer bit MUST be zero on
   transmission, and MUST be ignored on reception.

19.6. RD (Recursion Desired) Bit

   In both multicast query and multicast response messages, the
   Recursion Desired bit SHOULD be zero on transmission, and MUST be
   ignored on reception.

19.7. RA (Recursion Available) Bit

   In both multicast query and multicast response messages, the
   Recursion Available bit MUST be zero on transmission, and MUST be
   ignored on reception.

19.8. Z (Zero) Bit

   In both query and response messages, the Zero bit MUST be zero on
   transmission, and MUST be ignored on reception.

19.9. AD (Authentic Data) Bit [RFC 2535]

   In query messages the Authentic Data bit MUST be zero on
   transmission, and MUST be ignored on reception.


